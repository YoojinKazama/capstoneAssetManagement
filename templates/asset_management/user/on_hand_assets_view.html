<!-- Apply layout from base.html -->
{%extends 'asset_management/user/user_base.html'%}

{%block plugins_css%}
<link rel="stylesheet" href="{{url_for('static', path='/plugins/toastr/toastr.min.css')}}">
<link rel="stylesheet" href="{{url_for('static', path='/plugins/datatables-select/css/select.bootstrap4.min.css')}}">
{%endblock%}

{% block title %}View Asset{% endblock %}
{% block title_header %} <div id="view_title"> </div>{% endblock %}


{%block content%}



<div class="card card-primary card-outline">
    <div class="card-header">
        <div class="btn-group float-right" style="margin-bottom: 10px">
            <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown">Edit Status
            </button>
                <div class="dropdown-menu edit-status" role="menu">
                    
                </div>
        </div>
    </div>
    <div class="card-body">
    
        <div class="row">
            <div class="col-md-3 border-top border-left border-right">
                <label for="asset_title">Asset Title</label><br>
                <span name="asset_title" id="asset_title" > </span>
            </div>
            <div class="col-md-3 border-top border-right">
                <label for="asset_number">Asset Number</label><br>
                <span name="asset_number" id="asset_number" > </span>
            </div>
            <div class="col-md-3 border-top border-right">
                <label for="asset_type">Category</label><br>
                <span  name="asset_type" id="asset_type" > </span>
            </div>
            <div class="col-md-3 border-top border-right">
                <label for="asset_status">Status</label><br>
                <span  name="asset_status" id="asset_status" > </span>
            </div>
        </div> 
        <div class="row">
            <div class="col-md-4 border-top border-left">
                <label for="asset_acquisition">Acquisiton</label><br>
                <span name="asset_acquisition" id="asset_acquisition" > </span>
            </div>
            <div class="col-md-4 border">
                <label for="acquisition_date" >Acquisiton Date</label><br>
                <span  name="acquisition_date" id="acquisition_date" > </span>
            </div>
            <div class="col-md-4 border-top border-right">
                <label for="asset_cost">Cost</label><br>
                <span  name="asset_cost" id="asset_cost" > </span>
            </div>
        </div>
        <div class="row">
            <div class="col-md-4 border-top border-left">
                <label for="asset_brand">Brand</label><br>
                <span name="asset_brand" id="asset_brand" > </span>
            </div>
            <div class="col-md-4 border-left border-right">
                <label for="asset_model">Model</label><br>
                <span  name="asset_model" id="asset_model" > </span>
            </div>
            <div class="col-md-4 border-top border-right">
                <label for="asset_serial">Serial</label><br>
                <span  name="asset_serial" id="asset_serial" > </span>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12 border">
                <label for="asset_description">Description</label><br>
                <span name="asset_description" id="asset_description" > </span>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12 border-bottom border-left border-right">
                <label for="created_by">Created by</label><br>
                <span name="created_by" id="created_by" > </span>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12 border-bottom border-left border-right">
                <label for="asset_remarks">Remarks</label><br>
                <span name="asset_remarks" id="asset_remarks" > </span>
            </div>
        </div>
    </div>
</div>

<div class="card card-primary">
    <div class="card-header"> 
        <h5> Asset Provider</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class = "col-md-12 border">
                <label for="asset_provider_name">Provider:</label><br>
                <span name="asset_provider_name" id="asset_provider_name" > </span>
            </div>
        </div>
        <div class="row">
            <div class = "col-md-6 border-left border-right border-bottom">
                <label for="asset_provider_contact">Contact:</label><br>
                <span  name="asset_provider_contact" id="asset_provider_contact" > </span>
            </div>
            <div class = "col-md-6 border-right border-bottom">
                <label for="asset_provider_email">Email:</label><br>
                <span name="asset_provider_email" id="asset_provider_email" > </span> 
            </div>
        </div>
    </div>
</div>

<div class="card card-primary" id="ifCheckOut">
    
</div>

<div class="row">

<div class="col-12 col-md-12">
    <div class="card card-primary card-outline card-tabs">
        <div class="card-header p-0 pt-1 border-bottom-0">
        <ul class="nav nav-tabs" id="custom-tabs-three-tab" role="tablist">
            <li class="nav-item">
            <a class="nav-link active" id="custom-tabs-three-home-tab" data-toggle="pill" href="#custom-tabs-three-home" role="tab" aria-controls="custom-tabs-three-home" aria-selected="true">Events</a>
            </li>
            <li class="nav-item">
            <a class="nav-link" id="custom-tabs-three-profile-tab" data-toggle="pill" href="#custom-tabs-three-profile" role="tab" aria-controls="custom-tabs-three-profile" aria-selected="false">Maintenance</a>
            </li>
            <li class="nav-item">
            <a class="nav-link" id="custom-tabs-three-messages-tab" data-toggle="pill" href="#custom-tabs-three-messages" role="tab" aria-controls="custom-tabs-three-messages" aria-selected="false">Warranty</a>
            </li>
        </ul>
        </div>
        <div class="card-body">
        <div class="tab-content" id="custom-tabs-three-tabContent">
            <div class="tab-pane fade" id="custom-tabs-three-messages" role="tabpanel" aria-labelledby="custom-tabs-three-messages-tab">
                Morbi turpis dolor, vulputate vitae felis non, tincidunt congue mauris. Phasellus volutpat augue id mi placerat mollis. Vivamus faucibus eu massa eget condimentum. 
            </div>
            <div class="tab-pane fade show active" id="custom-tabs-three-home" role="tabpanel" aria-labelledby="custom-tabs-three-home-tab">
                <div class="container-fluid">

                    <!-- Timelime example  -->
                    <div class="row">
                      <div class="col-md-12">
                        <!-- The time line -->
                        <div class="timeline">
                          
                          <div>
                            <i class="fas fa-clock bg-gray"></i>
                          </div>
                        </div>
                      </div>
                      <!-- /.col -->
                    </div>
                  </div>
            </div>
            <div class="tab-pane fade" id="custom-tabs-three-profile" role="tabpanel" aria-labelledby="custom-tabs-three-profile-tab">
                {% include 'asset_management/user/maintenance.html' %}
            </div>
            
        </div>
        </div>
</div>
</div>
</div>


<!-- MODALS -->



<!-- EDIT ASSET -->
<div class="modal fade" id="editAsset" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editAssetTitle"></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
            <form id="editAssetForm">
                <div class="form-row">
                    <div class="form-group col-sm-12">
                        <label for="edit_asset_title">Title</label><label style="color: red;">*</label>
                        <input required class="form-control" name="edit_asset_title" id="edit_asset_title"  >
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-sm-6">
                        <label for="edit_asset_type">Category</label><label style="color: red;">*</label>
                        <select required name="edit_asset_type" id="edit_asset_type" class="form-control">
                            
                        </select>
                    </div>
                    <div class="form-group col-sm-6">
                        <label for="edit_asset_provider">Asset Provider</label><label style="color: red;">*</label>
                        <select required name="edit_asset_provider" id="edit_asset_provider" class="form-control">
                            
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-groupcol-sm-6">
                        <label for="asset_cost">Cost</label><label style="color: red;">*</label>
                        <div class="input-group mb-2">
                            <div class="input-group-prepend">
                                <div class="input-group-text">â‚±</div>
                            </div>
                            <input required type="number"  class="form-control" name="edit_asset_cost" id="edit_asset_cost"  >
                        </div>
                    </div>
                    <div class="form-group col-sm-6">
                        <label for="edit_asset_acquisition">Acquisition</label><label style="color: red;">*</label>
                        <select required name="edit_asset_acquisition" id="edit_asset_acquisition" class="form-control">
                            <option value="">- - Select - -</option>
                            <option value="Bought">Bought</option>
                            <option value="Donated">Donated</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-sm-12">
                        <label for="acquisition_date">Acquisition Date</label><label style="color: red;">*</label>
                        <input required type="date" class="form-control" name="edit_acquisition_date" id="edit_acquisition_date" >
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-sm-4 ">
                        <label for="asset_brand">Brand</label>
                        <input  class="form-control" name="edit_asset_brand" id="edit_asset_brand"  >
                    </div>
                    <div class="form-group col-sm-4">
                        <label for="asset_model">Model</label>
                        <input  class="form-control" name="edit_asset_model" id="edit_asset_model"  >
                    </div>
                    <div class="form-group col-sm-4">
                        <label for="asset_serial">Serial</label>
                        <input  class="form-control" name="edit_asset_serial" id="edit_asset_serial"  >
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-sm-12">
                        <label for="asset_description">Description</label>
                        <textarea style="margin-top: 10px;" rows="2" cols="50" class="form-control" name="edit_asset_description" id="edit_asset_description">
                        </textarea>
                    </div>
                </div> 
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
    <input type="submit" class="btn btn-primary" value="Save" id="editAssetBtn">            
    </form>
</div>
  </div>
  </div>
  </div>
  
{% include 'asset_management/admin/status_modals.html' %}


<!-- Confirm Delete Modal -->
<div class="modal fade" id="confirm_delete">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title text-secondary"><i class="fas fa-exclamation-triangle"></i>&nbsp;&nbsp;Delete Asset</h4>
          <button type="button" class="btn btn-sm btn-default" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true"><i class="fas fa-times"></i></span>
          </button>
        </div>
        <div class="modal-body">
          <p>Are you sure to delete this asset?</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-info confirmed_delete">Yes, delete it.</button>
        </div>
      </div>
      <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
  </div>
  <!-- /.modal -->

  <div class="modal fade" id="checkOutModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-lg modal-dialog modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Check Out</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="card-body">
              <div><label for="">Check-out to:</label><label style="color: red;">*</label></div>
              <form id="checkout_form">
                  <div class="form-row">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="checkout_to" id="checkout_person">
                        <label class="form-check-label" for="checkout_person">
                          Person
                        </label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="checkout_to" id="checkout_department">
                        <label class="form-check-label" for="checkout_department">
                          Department
                        </label>
                    </div>
                  </div>
                <div class="card-body" id="checkout_table">
                
                </div>
                <div class="form-row">
                    <div class="form-group col-sm-12 ">
                        <label for="check_out_loc">Location</label>
                        <input type="text" class="form-control" name="check_out_loc" id="check_out_loc"  >
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-sm-12 ">
                        <label for="check_out_date">Check-out Date</label>
                        <input type="date" class="form-control" name="check_out_date" id="check_out_date"  >
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="check_out_due_box" id="check_out_due_box">
                        <label class="form-check-label" for="check_out_due_box">
                          With Due Date
                        </label>
                    </div>
                </div>
                <div class="form-row" id="with_due">
                    
                </div>
                <div class="form-row">
                    <div class="form-group col-sm-12 ">
                        <label for="check_out_remarks">Remarks</label>
                        <textarea style="margin-top: 10px;" rows="2" cols="50" class="form-control" name="check_out_remarks" id="check_out_remarks">
                        </textarea>
                    </div>
                </div>

        </div>
      </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <input type="submit" class="btn btn-primary" value="Check Out" id="checkout_submit">
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="checkInModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-lg modal-dialog modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Check In</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="card-body">
              <form id="checkin_form">
                <div class="form-row">
                    <div class="form-group col-sm-12 ">
                        <label for="check_in_loc">Check-in Location</label>
                        <input hidden type="text" class="form-control" name="check_out_id" id="check_out_id"  >
                        <input type="text" class="form-control" name="check_in_loc" id="check_in_loc"  >
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-sm-12 ">
                        <label for="check_in_date">Check-in Date</label>
                        <input type="date" class="form-control" name="check_in_date" id="check_in_date"  >
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group col-sm-12 ">
                        <label for="check_in_remarks">Remarks</label>
                        <textarea style="margin-top: 10px;" rows="2" cols="50" class="form-control" name="check_in_remarks" id="check_in_remarks">
                        </textarea>
                    </div>
                </div>

        </div>
      </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <input type="submit" class="btn btn-primary" value="Check In" id="checkin_submit">
          </form>
        </div>
      </div>
    </div>
  </div>
{%endblock%}

{% block scripts%}
<script src="{{url_for('static', path='/plugins/toastr/toastr.min.js')}}"></script>
<script src="{{url_for('static', path='/plugins/moment/moment.min.js')}}"></script>
<script src="{{url_for('static', path='/dist/js/asset_management/event.js')}}"></script>
<script src="{{url_for('static', path='/dist/js/asset_management/status.js')}}"></script>
<script>

function editDropdowns(){

    $.ajax({
      url: '/asset_management/api/Asset_Type/',
      type: "GET",
      dataType: "JSON",

      success: function(data){
        var asset_type = data.data;

        var html = ""

        if(asset_type.length == 0){
              var html = `<option value=""> - - No Category - - </option>`;
            }
        else{
            var html = `<option value=""> - - Select Category - - </option>`;
        }

        for(var i=0; i < asset_type.length; i++){
          html += `<option value="${asset_type[i].asset_type_id}">${asset_type[i].asset_type_title}</option>`
        }
        
        $('#edit_asset_type').html(html);

            $.ajax({
                url: '/asset_management/api/Asset_Provider/',
                type: "GET",
                dataType: "JSON",

                success: function(data){
                    var asset_provider = data.data;

                    var html = ""

                    if(asset_provider.length == 0){
                      var html = `<option value=""> - - No Provider - - </option>`;
                    }
                    else{
                      var html = `<option value=""> - - Select Provider - - </option>`;
                    }

                    for(var i=0; i < asset_provider.length; i++){
                    html += `<option value="${asset_provider[i].asset_provider_id}">${asset_provider[i].asset_provider_name}</option>`
                    }
                    
                    $('#edit_asset_provider').html(html);
                    

                }
                })
      }
    })
}

function assetDetails(){
var id = "{{id}}"
var status_show = ""
$(".created_by_id").val(sessionStorage.getItem("id"));
        $.ajax({
                url: '/asset_management/api/Asset/' + id,
                type: "GET",
                data: { id: id },
                dataType: "JSON",
            
                success: function(data){
                    var asset_info = data.data;
                    
                    console.log(asset_info);

                    $("#view_title").html( "<h3>" + asset_info.asset_title + "</h3>" );

                    $("#asset_title").html(asset_info.asset_title );
                    $("#asset_type").html(asset_info.asset_type.asset_type_title );
                    $("#asset_number").html(asset_info.asset_number );
                    $("#asset_cost").html("â‚±" + asset_info.asset_cost);
                    $("#asset_acquisition").html( asset_info.asset_acquisition);
                    $("#acquisition_date").html(moment(asset_info.acquisition_date).format('LL'));

                    if (asset_info.asset_model == ""){
                        $("#asset_model").html('<div class="text-secondary font-italic">Not set</div>')
                    } else{
                        $("#asset_model").html(asset_info.asset_model);
                    }

                    if (asset_info.asset_brand == ""){
                        $("#asset_brand").html('<div class="text-secondary font-italic">Not set</div>')
                    } else{
                        $("#asset_brand").html(asset_info.asset_brand);
                    }

                    if (asset_info.asset_serial == ""){
                        $("#asset_serial").html('<div class="text-secondary font-italic">Not set</div>')
                    } else{
                        $("#asset_serial").html(asset_info.asset_serial);
                    }

                    if (asset_info.asset_description == "                        "){
                        $("#asset_description").html('<div class="text-secondary font-italic">Not set</div>')
                    } else{
                        $("#asset_description").html(asset_info.asset_description);
                    }

                    
                    $("#created_by").html(asset_info.created_by_details.user_name);

                    if (asset_info.asset_remarks == null){
                        $("#asset_remarks").html('<div class="text-secondary font-italic">Not set</div>')
                    } else{
                        $("#asset_remarks").html(asset_info.asset_remarks);
                    }


                    $(".current_status").val(asset_info.asset_status);

                    if (asset_info.asset_status == "Available"){
                        $("#asset_status").html('<div class="status badge badge-success p-2 w-100"><i class="fas fa-check-circle mr-1"></i><span>Available</span></div>');
                        $(".edit-status").html('<a class="dropdown-item" data-toggle="modal" data-target="#repairModal" ><i class="fas fa-hammer"></i>&nbsp;Repair</a>' +
                                                '<a class="dropdown-item" data-toggle="modal" data-target="#brokenModal" ><i class="fas fa-heart-broken"></i>&nbsp;Broken</a>' +
                                                '<a class="dropdown-item" data-toggle="modal" data-target="#missingModal" ><i class="fas fa-sticky-note"></i>&nbsp;Missing</a>' +
                                                '<a class="dropdown-item" data-toggle="modal" data-target="#disposeModal" ><i class="fas fa-thumbs-down"></i>&nbsp;Dispose</a>');
                    }
                    if (asset_info.asset_status == "Missing"){
                        $("#asset_status").html('<div class="status badge badge-warning p-2 w-100"><i class="fas fa-check-circle mr-1"></i><span>Missing</span></div>');
                        $(".edit-status").html('<a class="dropdown-item" data-toggle="modal" data-target="#repairModal" ><i class="fas fa-hammer"></i>&nbsp;Repair</a>' +
                                                '<a class="dropdown-item" data-toggle="modal" data-target="#brokenModal" ><i class="fas fa-heart-broken"></i>&nbsp;Broken</a>' +
                                                '<a class="dropdown-item undo-missing" ><i class="fas fa-sticky-note"></i>&nbsp;Undo Missing</a>' +
                                                '<a class="dropdown-item" data-toggle="modal" data-target="#disposeModal" ><i class="fas fa-thumbs-down"></i>&nbsp;Dispose</a>');
                    }

                    if (asset_info.asset_status == "Sold"){
                        $("#asset_status").html('<div class="status badge badge-info p-2 w-100"><i class="fas fa-dollar-sign mr-1"></i><span>Sold</span></div>');
                        $(".edit-status").html('<a class="dropdown-item" ><i class="fas fa-dollar-sign"></i>&nbsp;SOLD</a>');
                    }

                    if (asset_info.asset_status == "Disposed"){
                        $("#asset_status").html('<div class="status badge badge-info p-2 w-100"><i class="fas fa-thumbs-down mr-1"></i><span>Disposed</span></div>');
                        $(".edit-status").html('<a class="dropdown-item" data-toggle="modal" data-target="#repairModal" ><i class="fas fa-hammer"></i>&nbsp;Repair</a>' +
                                                '<a class="dropdown-item" data-toggle="modal" data-target="#brokenModal" ><i class="fas fa-heart-broken"></i>&nbsp;Broken</a>' +
                                                '<a class="dropdown-item" data-toggle="modal" data-target="#missingModal" ><i class="fas fa-sticky-note"></i>&nbsp;Missing</a>' +
                                                '<a class="dropdown-item undo-disposed" ><i class="fas fa-thumbs-down"></i>&nbsp;Undo Dispose</a>');
                    }

                    if (asset_info.asset_status == "Broken"){
                        $("#asset_status").html('<div class="status badge badge-warning p-2 w-100"><i class="fas fa-heart-broken mr-1"></i><span>Broken</span></div>');
                        $(".edit-status").html('<a class="dropdown-item" data-toggle="modal" data-target="#repairModal" ><i class="fas fa-hammer"></i>&nbsp;Repair</a>' +
                                                '<a class="dropdown-item undo-broken" ><i class="fas fa-heart-broken"></i>&nbsp;Undo Broken</a>' +
                                                '<a class="dropdown-item" data-toggle="modal" data-target="#missingModal" ><i class="fas fa-sticky-note"></i>&nbsp;Missing</a>' +
                                                '<a class="dropdown-item" data-toggle="modal" data-target="#disposeModal" ><i class="fas fa-thumbs-down"></i>&nbsp;Dispose</a>');
                    }

                    if (asset_info.asset_status == "Repair"){
                        $("#asset_status").html('<div class="status badge badge-info p-2 w-100"><i class="fas fa-hammer mr-1"></i><span>Repair</span></div>');
                        $(".edit-status").html('<a class="dropdown-item undo-repair" ><i class="fas fa-hammer"></i>&nbsp;Undo Repair</a>' +
                                                '<a class="dropdown-item" data-toggle="modal" data-target="#brokenModal" ><i class="fas fa-heart-broken"></i>&nbsp;Broken</a>' +
                                                '<a class="dropdown-item" data-toggle="modal" data-target="#missingModal" ><i class="fas fa-sticky-note"></i>&nbsp;Missing</a>' +
                                                '<a class="dropdown-item" data-toggle="modal" data-target="#disposeModal" ><i class="fas fa-thumbs-down"></i>&nbsp;Dispose</a>');
                    }

                    //ASSET_PROVIDER
                    $("#asset_provider_name").html(asset_info.asset_provider.asset_provider_name );
                    $("#asset_provider_contact").html(asset_info.asset_provider.asset_provider_contact );
                    $("#asset_provider_email").html(asset_info.asset_provider.asset_provider_email );

                    status_show = asset_info.asset_status
                }
        });

        $.ajax({
            url: '/asset_management/api/Check_out/' + "{{id}}",
            type: "GET",
            dataType: "JSON",
        
            success: function(data){
                console.log(data.data)
                if(data.data != null){
                    html = ""
                    html += '<div class="card-header"> '+
                        '<h5>Checked-out to</h5>'+
                    '</div>'+
                    '<div class="card-body">'+
                        '<div class="row">'+
                            '<div class = "col-md-6 border">'+
                                '<label for="view_check_out_to">Checked-out to:</label><br>' +
                                '<span name="view_check_out_to" id="view_check_out_to" > </span>' +
                            '</div>' +
                            '<div class = "col-md-6 border-top border-right optional_dept">' +
                                '<label for="view_check_out_to_department">Department:</label><br>' +
                                '<span name="view_check_out_to_department" id="view_check_out_to_department" > </span>' +
                            '</div>' +
                        '</div>' +
                        '<div class="row">' +
                            '<div class = "col-md-6 border-left border-right border-bottom">' +
                                '<label for="view_check_out_date">Check out Date:</label><br>' +
                                '<span  name="view_check_out_date" id="view_check_out_date" > </span>' +
                            '</div>' +
                            '<div class = "col-md-6 border-right border-bottom border-top">' +
                                '<label for="view_check_out_due">Check out Due:</label><br>' +
                                '<span name="view_check_out_due" id="view_check_out_due" > </span>' +
                                '<div class="if_due"></div>'
                            '</div>' +
                        '</div>' +
                        '<div class="row">' +
                            '<div class = "col-md-12 border-left border-right border-bottom">' +
                                '<label for="view_location">Location:</label><br>' +
                                '<span  name="view_location" id="view_location" > </span>' +
                            '</div>' +
                        '</div>' +
                        '<div class="row">' +
                            '<div class = "col-md-12 border-left border-right border-bottom">' +
                                '<label for="view_remarks">Remarks:</label><br>' +
                                '<span  name="view_remarks" id="view_remarks" > </span>' +
                            '</div>' +
                        '</div>' +
                    '</div>'

                    $("#ifCheckOut").html(html);

                check_out_details = data.data
                checked_to = ""
                user_department = ""

                if (check_out_details.user_id == null){
                    checked_to = check_out_details.on_department.department_name
                    $(".optional_dept").remove()
                }
                if (check_out_details.department_id == null){
                    checked_to = check_out_details.on_user.user_name
                    user_department = check_out_details.on_user.user_department.department_name
                }


                $("#check_out_id").val(check_out_details.check_out_id);
                $("#view_check_out_to").html(checked_to);
                $("#view_check_out_to_department").html(user_department);
                $("#view_check_out_date").html(moment(check_out_details.check_out_date).format('LL'));

                if (check_out_details.check_out_due == null){
                    $("#view_check_out_due").html('<div class="text-secondary font-italic">Not set</div>')
                }
                else{
                    $("#view_check_out_due").html(moment(check_out_details.check_out_due).format('LL'));
                }

                if (moment(new Date()).format('L') > moment(check_out_details.check_out_due).format('L')){
                    $("#view_check_out_due").html(moment(check_out_details.check_out_due).format('LL')+ '<span class="badge badge-warning">Past Due</span>')
                }
                //console.log(moment(new Date()).format('L'))
                //console.log(moment(check_out_details.check_out_due).format('L'))

                $("#view_location").html(check_out_details.location);

                if (check_out_details.remarks == "                        "){
                    $("#view_remarks").html('<div class="text-secondary font-italic">Not set</div>')
                }
                else{
                    $("#view_remarks").html(check_out_details.remarks);
                }

                    if (status_show == "Available"){
                        $(".status").remove();
                        $("#asset_status").html('<div class="status badge badge-success p-2 w-100"><i class="fas fa-thumbs-up mr-1"></i><span>Checked-out</span></div>');
                    }

                $(".check_out_class").html('<i class="fas fa-check-circle"></i>&nbsp;Check in</a>');
                $(".check_out_class").attr('data-target','#checkInModal');

                }
                  
            }
    });
}

assetDetails()
editDropdowns()
$(document).on("click", ".editAsset", function(){
        $.ajax({
                url: '/asset_management/api/Asset/' + "{{id}}",
                type: "GET",
                dataType: "JSON",
            
                success: function(data){
                    var asset_info = data.data;
                    console.log(asset_info);

                    $("#editAssetTitle").html("Edit " + asset_info.asset_title);
                    

                    //EDIT
                    $("#edit_asset_title").val(asset_info.asset_title );
                    $("#edit_asset_type").val(asset_info.asset_type.asset_type_id);
                    $("#edit_asset_provider").val(asset_info.asset_provider.asset_provider_id );
                    $("#edit_asset_number").val(asset_info.asset_number );
                    $("#edit_asset_cost").val(asset_info.asset_cost);
                    $("#edit_asset_acquisition").val(asset_info.asset_acquisition);
                    $("#edit_acquisition_date").val(moment(new Date(asset_info.acquisition_date)).format('YYYY[-]MM[-]DD'));
                    $("#edit_asset_model").val(asset_info.asset_model);
                    $("#edit_asset_brand").val(asset_info.asset_brand);
                    $("#edit_asset_serial").val(asset_info.asset_serial);
                    $("#edit_asset_description").val(asset_info.asset_description);

                }
        });
    });

$("#editAssetForm").on("submit", function(e){

    e.preventDefault();

    form =  { asset_provider_id: $(edit_asset_provider).val(),
                asset_type_id: $(edit_asset_type).val(),
                asset_cost: $(edit_asset_cost).val(),
                asset_title: $(edit_asset_title).val(),
                asset_description: $(edit_asset_description).val(),
                asset_brand: $(edit_asset_brand).val(),
                asset_model: $(edit_asset_model).val(),
                asset_serial: $(edit_asset_serial).val(),
                asset_acquisition: $(edit_asset_acquisition).val(),
                acquisition_date: new Date($(edit_acquisition_date).val())
                };

    encoded = JSON.stringify(form)
    console.log(encoded)

        $.ajax({
            url:'/asset_management/api/Asset/' + "{{id}}",
            type: "PUT",
            data: encoded,
            dataType: "JSON",
            contentType: "application/json",

            success: function(data){

                events = {
                    asset_id : "{{id}}",
                    event_title : "Edited",
                    event_message: "Edited by " + sessionStorage.getItem("name")
                  }

                    $.ajax({
                    url:'/asset_management/api/Event/',
                    type: "POST",
                    data: JSON.stringify(events),
                    dataType: "JSON",
                    contentType: "application/json",

                    success: function(data){
                    console.log("EVENT CREATED")

                    assetDetails()
                    load_event("{{id}}")
                    $('#editAsset').modal('hide');
                    toastr.success('Asset edited successfully')
                    }
                })
            }
        })
    });

$(document).on("click", "#asset_delete", function(){
    var id = this.id;
    $('#confirm_delete').modal('show');
    
        $(document).on("click", ".confirmed_delete", function(){
            
            $.ajax({
                url: '/asset_management/api/Asset/' + "{{id}}",
                type: "DELETE",
                dataType: "JSON",
            
                success: function(data){

                window.location.href = "/asset_management/asset/"
                }
            // ajax closing tag
            })
            
        });
    
    });

    $(document).on("click", ".undo-missing", function(){
         $.ajax({
             url: '/asset_management/api/missing_asset/undo/' + "{{id}}",
             type: "DELETE",
             dataType: "JSON",
        
             success: function(data){

                events = {
                    asset_id : "{{id}}",
                    event_title : "Undo Missing",
                    event_message: "Updated by " + sessionStorage.getItem("name")
                  }
    
                $.ajax({
                    url:'/asset_management/api/Event/',
                    type: "POST",
                    data: JSON.stringify(events),
                    dataType: "JSON",
                    contentType: "application/json",

                    success: function(data){
                    console.log("EVENT CREATED")

                    assetDetails()
                    load_event("{{id}}")
                    toastr.success('Asset edited successfully')
                    }
                })
             }
         // ajax closing tag
         })
        
    });

    $(document).on("click", ".undo-sold", function(){
        $.ajax({
            url: '/asset_management/api/sell_asset/undo/' + "{{id}}",
            type: "DELETE",
            dataType: "JSON",
       
            success: function(data){

               events = {
                   asset_id : "{{id}}",
                   event_title : "Undo Sold",
                   event_message: "Updated by " + sessionStorage.getItem("name")
                 }
   
               $.ajax({
                   url:'/asset_management/api/Event/',
                   type: "POST",
                   data: JSON.stringify(events),
                   dataType: "JSON",
                   contentType: "application/json",

                   success: function(data){
                   console.log("EVENT CREATED")

                   assetDetails()
                   load_event("{{id}}")
                   toastr.success('Asset edited successfully')
                   }
               })
            }
        // ajax closing tag
        })
       
   });

   $(document).on("click", ".undo-disposed", function(){
    $.ajax({
        url: '/asset_management/api/dispose_asset/undo/' + "{{id}}",
        type: "DELETE",
        dataType: "JSON",
   
        success: function(data){

           events = {
               asset_id : "{{id}}",
               event_title : "Undo Disposed",
               event_message: "Updated by " + sessionStorage.getItem("name")
             }

           $.ajax({
               url:'/asset_management/api/Event/',
               type: "POST",
               data: JSON.stringify(events),
               dataType: "JSON",
               contentType: "application/json",

               success: function(data){
               console.log("EVENT CREATED")

               assetDetails()
               load_event("{{id}}")
               toastr.success('Asset edited successfully')
               }
           })
        }
    // ajax closing tag
    })
   
});

$(document).on("click", ".undo-broken", function(){
    $.ajax({
        url: '/asset_management/api/broken_asset/undo/' + "{{id}}",
        type: "DELETE",
        dataType: "JSON",
   
        success: function(data){

           events = {
               asset_id : "{{id}}",
               event_title : "Undo Broken",
               event_message: "Updated by " + sessionStorage.getItem("name")
             }

           $.ajax({
               url:'/asset_management/api/Event/',
               type: "POST",
               data: JSON.stringify(events),
               dataType: "JSON",
               contentType: "application/json",

               success: function(data){
               console.log("EVENT CREATED")

               assetDetails()
               load_event("{{id}}")
               toastr.success('Asset edited successfully')
               }
           })
        }
    // ajax closing tag
    })
   
});

$(document).on("click", ".undo-repair", function(){
    $.ajax({
        url: '/asset_management/api/repair_asset/undo/' + "{{id}}",
        type: "DELETE",
        dataType: "JSON",
   
        success: function(data){

           events = {
               asset_id : "{{id}}",
               event_title : "Undo Repair",
               event_message: "Updated by " + sessionStorage.getItem("name")
             }

           $.ajax({
               url:'/asset_management/api/Event/',
               type: "POST",
               data: JSON.stringify(events),
               dataType: "JSON",
               contentType: "application/json",

               success: function(data){
               console.log("EVENT CREATED")

               assetDetails()
               load_event("{{id}}")
               toastr.success('Asset edited successfully')
               }
           })
        }
    // ajax closing tag
    })
   
});

$('#checkout_department').change(function(){
    if(this.checked) {
        html = '<table style = "width: 100% !important" id="department_table" class="table table-bordered table-hover">' +
            '<thead>' +
            '<tr>' +
                '<th>ID</th>' +
                '<th>Department Name</th>' +
            '</tr>' +
            '</thead>' +
            '</table>'

        $('#checkout_table').html(html);
        
        $("#department_table").DataTable({

            ajax: "/asset_management/api/Department/",
            select: true,
            columns: [
                    { data: "department_id"},
                    { data: "department_name"},
                    
            ],
            "order": [[1, "desc"]]
            
            })
    }
    var table = $('#department_table').DataTable();
    $('#department_table tbody').on( 'click', 'tr', function () {
        if ( $(this).hasClass('selected') ) {
            $(this).removeClass('selected');
        }
        else {
            table.$('tr.selected').removeClass('selected');
            $(this).addClass('selected');
            selectedRow = table.rows('.selected').data()[0]["department_id"]
            selectedName = table.rows('.selected').data()[0]["department_name"]
        }
    } );
    selectedRow = table.rows('.selected')
});

$('#check_out_due_box').change(function(){
    if(this.checked) {
        html = '<div class="form-group col-sm-12 with_due">' +
            '<label for="check_out_due">Due Date</label>' +
            '<input type="date" class="form-control" name="check_out_due" id="check_out_due"  >' +
        '</div>'

        $('#with_due').html(html);
    }
    else{
        $('.with_due').remove();
    }
});

$('#checkout_person').change(function(){
    if(this.checked) {
        html = '<table style = "width: 100% !important" id="person_table" class="table table-bordered table-hover">' +
            '<thead>' +
            '<tr>' +
                '<th>ID</th>' +
                '<th>Employee Name</th>' +
                '<th>Department</th>' +
                '<th>Email</th>' +
                '<th>User Type</th>' +
                '<th>Created At</th>' +
            '</tr>' +
            '</thead>' +
            '</table>'

        $('#checkout_table').html(html);
        
        $("#person_table").DataTable({

            ajax: "/asset_management/api/Auth/",
            select: true,
            columns: [
                    { data: "user_id"},
                    { data: "user_name"},
                    { data: "user_department.department_name", render:function(data){
                    if (data == null){
                        html = '<div class="text-secondary font-italic">Not set</div>'
                    return html
                    }
                    return data
                         } 
                    },
                    { data: "user_email"},
                    { data: "user_type"},
                    { data: "created_at"},
                    
            ],
            "aoColumnDefs": [{ "bVisible": false, "aTargets": [0, 5] }],
            "order": [[5, "desc"]]
            
            })
    }
    var table = $('#person_table').DataTable();
    $('#person_table tbody').on( 'click', 'tr', function () {
        if ( $(this).hasClass('selected') ) {
            $(this).removeClass('selected');
        }
        else {
            table.$('tr.selected').removeClass('selected');
            $(this).addClass('selected');
            selectedRow = table.rows('.selected').data()[0]["user_id"]
            selectedName = table.rows('.selected').data()[0]["user_name"]
        }
    } );
    
});

$("#checkout_form").on("submit", function(e){
    e.preventDefault()

    person_id = null
    department_id = null
    due_date = null

    if($("#check_out_due_box").is(":checked")){
        due_date = new Date($(check_out_due).val())
    }

    if($("#checkout_person").is(":checked")){
        person_id = selectedRow
        
    }
    if($("#checkout_department").is(":checked")){
        department_id = selectedRow
        
    }

    form =  { asset_id: "{{id}}",
                user_id: person_id,
                department_id: department_id,
                location: $(check_out_loc).val(),
                check_out_date: new Date($(check_out_date).val()),
                check_out_due: due_date,
                remarks: $(check_out_remarks).val()
                };

    console.log(JSON.stringify(form))

    $.ajax({
               url:'/asset_management/api/Check_out/',
               type: "POST",
               data: JSON.stringify(form),
               dataType: "JSON",
               contentType: "application/json",

               success: function(data){

               events = {
                asset_id : "{{id}}",
                event_title : "Asset Checked-out",
                event_message: "Asset checked-out to " + selectedName + " at " + moment($(check_out_date).val()).format('LL') +
                                " by " + sessionStorage.getItem("name")
              }
 
            $.ajax({
                url:'/asset_management/api/Event/',
                type: "POST",
                data: JSON.stringify(events),
                dataType: "JSON",
                contentType: "application/json",
 
                success: function(data){
                console.log("EVENT CREATED")
 
                assetDetails()
                load_event("{{id}}")
                $('#checkOutModal').modal('hide');
                toastr.success('Asset check-out successfully')
                }
            })
               }
           })
    });


    $("#checkin_form").on("submit", function(e){
        e.preventDefault()
    
        form =  {
                    check_out_id: $(check_out_id).val(),
                    return_location: $(check_in_loc).val(),
                    return_date: new Date($(check_in_date).val()),
                    remarks: $(check_in_remarks).val()
                    };
    
        //console.log(JSON.stringify(form))
    
            $.ajax({
                url:'/asset_management/api/Check_in/',
                type: "POST",
                data: JSON.stringify(form),
                dataType: "JSON",
                contentType: "application/json",

                success: function(data){

                events = {
                asset_id : "{{id}}",
                event_title : "Asset Checked-in",
                event_message: "Asset checked-in at " + moment($(check_in_date).val()).format('LL') +
                                " by " + sessionStorage.getItem("name")
                }

                    $.ajax({
                        url:'/asset_management/api/Event/',
                        type: "POST",
                        data: JSON.stringify(events),
                        dataType: "JSON",
                        contentType: "application/json",

                        success: function(data){
                        console.log("EVENT CREATED")

                        assetDetails()
                        load_event("{{id}}")
                        $('#checkInModal').modal('hide');
                        toastr.success('Asset check-in successfully')
                        }
                    })
                }
            })
        });

    load_event("{{id}}")
</script>
{% endblock %}

